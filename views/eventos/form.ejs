<%- include('../partials/header', { title }) %>

    <div class="container mt-4">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-<%= isEditing ? 'edit' : 'plus' %>"></i>
                    <%= isEditing ? 'Editar' : 'Registrar' %> Evento
                </h4>
            </div>
            <div class="card-body">
                <% if (errors && errors.length> 0) { %>
                    <div class="alert alert-danger">
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle"></i> Errores de validación</h5>
                        <ul class="mb-0">
                            <% errors.forEach(error=> { %>
                                <li>
                                    <%= error.msg %>
                                </li>
                                <% }); %>
                        </ul>
                    </div>
                    <% } %>

                        <form action="<%= isEditing ? `/eventos/${evento.id_evento}?_method=PUT` : '/eventos' %>"
                            method="POST">
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="nombre_evento">Nombre del evento</label>
                                    <input type="text" class="form-control" id="nombre_evento" name="nombre_evento"
                                        value="<%= evento.nombre_evento || '' %>" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="categoria_evento">Categoría</label>
                                    <input type="text" class="form-control" id="categoria_evento"
                                        name="categoria_evento" value="<%= evento.categoria_evento || '' %>" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="lugar_evento">Lugar</label>
                                    <input type="text" class="form-control" id="lugar_evento" name="lugar_evento"
                                        value="<%= evento.lugar_evento || '' %>" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="ciudad_evento">Ciudad</label>
                                    <input type="text" class="form-control" id="ciudad_evento" name="ciudad_evento"
                                        value="<%= evento.ciudad_evento || '' %>" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="departamento_evento">Departamento</label>
                                    <input type="text" class="form-control" id="departamento_evento"
                                        name="departamento_evento" value="<%= evento.departamento_evento || '' %>"
                                        required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-4">
                                    <label for="aforo_evento">Aforo</label>
                                    <input type="number" class="form-control" id="aforo_evento" name="aforo_evento"
                                        value="<%= evento.aforo_evento || '' %>" required>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="genero_evento">Género</label>
                                    <input type="text" class="form-control" id="genero_evento" name="genero_evento"
                                        value="<%= evento.genero_evento || '' %>" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-4">
                                    <label for="fecha_inicio_evento">Fecha de inicio</label>
                                    <input type="date" class="form-control" id="fecha_inicio_evento"
                                        name="fecha_inicio_evento"
                                        value="<%= evento.fecha_inicio_evento ? (typeof evento.fecha_inicio_evento === 'string'  ? evento.fecha_inicio_evento  : evento.fecha_inicio_evento.toISOString().split('T')[0]) : '' %>"
                                        required>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="fecha_fin_evento">Fecha de fin</label>
                                    <input type="date" class="form-control" id="fecha_fin_evento"
                                        name="fecha_fin_evento"
                                        value="<%= evento.fecha_fin_evento ? evento.fecha_fin_evento.substring(0, 10) : '' %>"
                                        required>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="hora_apertura">Hora de apertura</label>
                                    <input type="datetime-local" class="form-control" id="hora_apertura"
                                        name="hora_apertura"
                                        value="<%= evento.fecha_fin_evento ? (typeof evento.fecha_fin_evento === 'string' ? evento.fecha_fin_evento : evento.fecha_fin_evento.toISOString().split('T')[0]) : '' %>"
                                        required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="edad_minima">Edad mínima</label>
                                    <input type="number" class="form-control" id="edad_minima" name="edad_minima"
                                        value="<%= evento.edad_minima || '' %>" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="id_artista_PK">ID del artista</label>
                                    <input type="number" class="form-control" id="id_artista_PK" name="id_artista_PK"
                                        value="<%= evento.id_artista_PK || '' %>" required>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="id_organizador_PK">ID del organizador</label>
                                    <input type="number" class="form-control" id="id_organizador_PK"
                                        name="id_organizador_PK" value="<%= evento.id_organizador_PK || '' %>" required>
                                </div>
                            </div>

                            <div class="form-group d-flex justify-content-between">
                                <a href="/eventos" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    <%= isEditing ? 'Actualizar' : 'Guardar' %>
                                </button>
                            </div>
                        </form>
            </div>
        </div>
    </div>
    <br>

    <%- include('../partials/footer') %>